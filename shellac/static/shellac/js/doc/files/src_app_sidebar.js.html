<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/app/sidebar.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/shellac.html">shellac</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src/app/sidebar.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/*
* sidebar.js
* Sidebar module
*/
/* global $, window, AudioContext, XMLHttpRequest */
&#x27;use strict&#x27;;

var sidebar = (function () {

    //---------------- BEGIN MODULE DEPENDENCIES --------------
    var TAFFY = require(&#x27;taffydb&#x27;).taffy,
        app_util = require(&#x27;./app_util.js&#x27;),
        util = require(&#x27;../util.js&#x27;),
        utils = util.utils;

    //---------------- END MODULE DEPENDENCIES --------------

    //---------------- BEGIN MODULE SCOPE VARIABLES --------------
    var

    configMap = {
        main_html: String() +
        &#x27;&lt;div class=&quot;shellac-app-sidebar-panel panel-group noSwipe&quot; id=&quot;accordion&quot;&gt;&#x27; +

            &#x27;&lt;div class=&quot;search-container&quot;&gt;&#x27; +
                &#x27;&lt;div class=&quot;form-group has-success has-feedback&quot;&gt;&#x27; +
                    &#x27;&lt;label class=&quot;control-label&quot; for=&quot;inputSuccess&quot;&gt;&lt;/label&gt;&#x27; +
                    &#x27;&lt;input type=&quot;text&quot; class=&quot;form-control search-query&quot; id=&quot;inputSuccess&quot;&gt;&#x27; +
                    &#x27;&lt;span class=&quot;glyphicon glyphicon-search form-control-feedback&quot;&gt;&lt;/span&gt;&#x27; +
                &#x27;&lt;/div&gt;&#x27; +
            &#x27;&lt;/div&gt;&#x27; +

            &#x27;&lt;div class=&quot;category panel panel-default&quot;&gt;&#x27; +
                &#x27;&lt;div class=&quot;panel-heading&quot;&gt;&#x27; +
                    &#x27;&lt;a data-toggle=&quot;collapse&quot; data-parent=&quot;#accordion&quot; href=&quot;#collapseCategories&quot;&gt;&#x27; +
                        &#x27;Categories&#x27; +
                    &#x27;&lt;/a&gt;&#x27; +
                &#x27;&lt;/div&gt;&#x27; +
                &#x27;&lt;div id=&quot;collapseCategories&quot; class=&quot;panel-collapse collapse&quot;&gt;&#x27; +
                    &#x27;&lt;div class=&quot;panel-body&quot;&gt;&#x27; +
                        &#x27;&lt;div class=&quot;list-group&quot;&gt;&lt;/div&gt;&#x27; +
                    &#x27;&lt;/div&gt;&#x27; +
                &#x27;&lt;/div&gt;&#x27; +
            &#x27;&lt;/div&gt;&#x27; +

            &#x27;&lt;div class=&quot;authors panel panel-default&quot;&gt;&#x27; +
                &#x27;&lt;div class=&quot;panel-heading&quot;&gt;&#x27; +
                    &#x27;&lt;a data-toggle=&quot;collapse&quot; data-parent=&quot;#accordion&quot; href=&quot;#collapseAuthors&quot;&gt;&#x27; +
                        &#x27;Authors&#x27; +
                    &#x27;&lt;/a&gt;&#x27; +
                &#x27;&lt;/div&gt;&#x27; +
                &#x27;&lt;div id=&quot;collapseAuthors&quot; class=&quot;panel-collapse collapse&quot;&gt;&#x27; +
                    &#x27;&lt;div class=&quot;panel-body&quot;&gt;&#x27; +
                        &#x27;&lt;div class=&quot;list-group&quot;&gt;&lt;/div&gt;&#x27; +
                    &#x27;&lt;/div&gt;&#x27; +
                &#x27;&lt;/div&gt;&#x27; +
            &#x27;&lt;/div&gt;&#x27; +

        &#x27;&lt;/div&gt;&#x27;,

        truncatemax: 10
    },

    stateMap = {
        $container: undefined,
        categories: undefined,
        category_db: TAFFY(),
        latest_clips_db: undefined,
    },

    initModule, setJqueryMap,

    onSubmitSearch, onTouchSidebar,

    init_sidebar, fetchUrl,
    parseCategoryData,


    onClickCategory, display_categories,
    onClickAuthor, display_authors,

    jqueryMap = {};

    //---------------- END MODULE SCOPE VARIABLES --------------

    //--------------------- BEGIN MODULE SCOPE METHODS --------------------

    /**
     * setJqueryMap record the jQuery elements of the page
     */
    setJqueryMap = function(){
        var $outerDiv = stateMap.$container;

        jqueryMap = {
            $outerDiv                       : $outerDiv,
            $sidebar_panel                  : $outerDiv.find(&#x27;.shellac-app-sidebar-panel&#x27;),

            $sidebar_search_container       : $outerDiv.find(&#x27;.shellac-app-sidebar-panel .search-container&#x27;),
            $sidebar_search_input           : $outerDiv.find(&#x27;.shellac-app-sidebar-panel .search-container .search-query&#x27;),
            $sidebar_search_submit          : $outerDiv.find(&#x27;.shellac-app-sidebar-panel .search-container .glyphicon.glyphicon-search&#x27;),

            $sidebar_category_panel         : $outerDiv.find(&#x27;.shellac-app-sidebar-panel .category.panel&#x27;),
            $sidebar_category_listGroup     : $outerDiv.find(&#x27;.shellac-app-sidebar-panel .category.panel #collapseCategories .panel-body .list-group&#x27;),

            $sidebar_authors_panel          : $outerDiv.find(&#x27;.shellac-app-sidebar-panel .authors.panel&#x27;),
            $sidebar_authors_listGroup      : $outerDiv.find(&#x27;.shellac-app-sidebar-panel .authors.panel #collapseAuthors .panel-body .list-group&#x27;)
        };
    };


    /**
     * method parseCategoryData: transform any Category fields to javascript-compatible
     * @param a string describing an array of valid JSON
     * @return jsonArray a list of valid JSON objects
     */
    parseCategoryData = function(raw){
        var jsonArray;
        jsonArray = raw.results.map(function(jsonObj){
            try{
                return jsonObj;
            }catch(err){
                console.error(err);
            }
        });
        return jsonArray;
    };

    //--------------------- END MODULE SCOPE METHODS --------------------

    //--------------------- BEGIN DOM METHODS --------------------
    /**
     * display_categories append the html for the category sidebar accordion section
     * @param category_list list containing formatted category objects
     * @param $container jquery container
     * @param latest_clips_db the TAFFY db containing relevant clip objects
     */
    display_categories = function($container, category_db, latest_clips_db){
        var all_anchor = String(),
            items = String(),
            count = latest_clips_db().count();

        (category_db().get()).forEach(function(category){
            var clip_array = latest_clips_db({categories: {has: category.url}});
            items +=
                &#x27;&lt;a class=&quot;list-group-item nav-sidebar-category&quot; href=&quot;#&quot;&gt;&#x27; + &#x27;&lt;span class=&quot;badge&quot;&gt;&#x27; + clip_array.count() + &#x27;&lt;/span&gt;&#x27; +
                    &#x27;&lt;h5 class=&quot;list-group-item-heading&quot; id=&quot;&#x27; + category.slug + &#x27;&quot;&gt;&#x27; + category.title + &#x27;&lt;/h5&gt;&#x27; +
                &#x27;&lt;/a&gt;&#x27;;
        });

        all_anchor +=
            &#x27;&lt;a class=&quot;list-group-item nav-sidebar-category active&quot; href=&quot;#&quot;&gt;&#x27; +
                &#x27;&lt;span class=&quot;badge&quot;&gt;&#x27; + count + &#x27;&lt;/span&gt;&#x27; +
                &#x27;&lt;h5 class=&quot;list-group-item-heading&quot; id=&quot;all&quot;&gt;ALL&lt;/h5&gt;&#x27; +
            &#x27;&lt;/a&gt;&#x27;;
        $container.append(all_anchor, items);

        //register listeners on &lt;h5&gt; element
        $(&#x27;.list-group-item.nav-sidebar-category&#x27;).on(&#x27;click&#x27;,
            {
                category_db: category_db,
                latest_clips_db: latest_clips_db
            },
            onClickCategory
        );
    };

    /**
     * display_authors append the html for the currently displayed clips
     * @param category_list list containing formatted category objects
     * @param $container jquery container
     * @param latest_clips_db the TAFFY db containing relevant clip objects
     */
    display_authors = function($container, latest_clips_db){

        var all_anchor = String(),
            items = String(),
            owner_list = latest_clips_db().distinct(&quot;owner&quot;);



        owner_list.forEach(function(owner){
            var clip_array = latest_clips_db({owner: {has: owner}});

            items +=
                &#x27;&lt;a class=&quot;list-group-item nav-sidebar-authors&quot; href=&quot;#&quot;&gt;&#x27; + &#x27;&lt;span class=&quot;badge&quot;&gt;&#x27; + clip_array.count() + &#x27;&lt;/span&gt;&#x27; +
                &#x27;&lt;h5 class=&quot;list-group-item-heading&quot; id=&quot;&#x27; + owner + &#x27;&quot;&gt;&#x27; + owner + &#x27;&lt;/h5&gt;&#x27; +
                &#x27;&lt;/a&gt;&#x27;;
        });

        all_anchor +=
            &#x27;&lt;a class=&quot;list-group-item nav-sidebar-authors active&quot; href=&quot;#&quot;&gt;&#x27; +
            &#x27;&lt;span class=&quot;badge&quot;&gt;&#x27; + latest_clips_db().count() + &#x27;&lt;/span&gt;&#x27; +
            &#x27;&lt;h5 class=&quot;list-group-item-heading&quot; id=&quot;all&quot;&gt;ALL&lt;/h5&gt;&#x27; +
            &#x27;&lt;/a&gt;&#x27;;
        $container.append(all_anchor, items);

        //register listeners on &lt;h5&gt; element
        $(&#x27;.list-group-item.nav-sidebar-authors&#x27;).on(&#x27;click&#x27;,
            {
                latest_clips_db: latest_clips_db
            },
            onClickAuthor
        );
    };
    //--------------------- END DOM METHODS ----------------------

    //------------------- BEGIN EVENT HANDLERS -------------------
    /**
     * onClickCategory callback for changes in the category UI.
     * Extracts the audio file url for each clip for the category
     * and emits a sidebar change event
     * @param event jQuery event object for the clicked elements
     */
    onClickCategory = function(event){

        var latest_clips_db = event.data.latest_clips_db,
            category_db = event.data.category_db,
            clips = [],
            category, $a, id;

        //remove the active class from all &lt;a&gt;
        jqueryMap.$sidebar_category_listGroup.find(&#x27;.list-group-item.nav-sidebar-category&#x27;).removeClass( &quot;active&quot;);

        //add the active class to current -- check if we clicked inner h5 and span elements within a
        $a = $(event.target).closest(&#x27;a&#x27;);
        $a.addClass(&quot;active&quot;);
        id = $a.find(&#x27;.list-group-item-heading&#x27;).attr(&#x27;id&#x27;);

        //refill the empty the clip array
        if(id === &quot;all&quot;){
            clips = latest_clips_db().get();

        } else {
            category = category_db({slug: id}).first();
            clips = latest_clips_db({categories: {has: category.url}}).get();
        }
        util.PubSub.emit( &quot;shellac-app-clip-change&quot;, clips);
    };


    /**
     * onClickAuthor callback for changes in the author UI.
     * Extracts the audio file url for each clip for the category
     * and emits a sidebar change event
     * @param event jQuery event object for the clicked elements
     */
    onClickAuthor = function(event){

        var latest_clips_db = event.data.latest_clips_db,
            clips = [],
            owner, $a, id;

        //remove the active class from all &lt;a&gt;
        jqueryMap.$sidebar_authors_listGroup.find(&#x27;.list-group-item.nav-sidebar-authors&#x27;).removeClass( &quot;active&quot;);

        //add the active class to current -- check if we clicked inner h5 and span elements within a
        $a = $(event.target).closest(&#x27;a&#x27;);
        $a.addClass(&quot;active&quot;);
        id = $a.find(&#x27;.list-group-item-heading&#x27;).attr(&#x27;id&#x27;); //owner

        //refill the empty the clip array
        if(id === &quot;all&quot;){
            clips = latest_clips_db().get();

        } else {
            clips = latest_clips_db({owner: {has: id}}).get();
        }

        util.PubSub.emit( &quot;shellac-app-clip-change&quot;, clips);
    };

    /**
     * onSubmitSearch callback for search box enter action
     * Calls the search api and responds with a sidebar change event emit
     * @param event jQuery event object for the clicked elements
     */
    onSubmitSearch = function(event){
        var q = jqueryMap.$sidebar_search_input.val(),
            endpoint = [&#x27;/api/clips/?q=&#x27;, q].join(&#x27;&#x27;);
        util.fetchUrl(endpoint, function(results){
            util.PubSub.emit( &quot;shellac-app-clip-change&quot;, app_util.parseClipData(results));
        });
    };

    onTouchSidebar = function(event, direction, distance, duration, fingerCount){
        event.preventDefault();
        jqueryMap.$outerDiv.toggleClass(&#x27;nav-expanded&#x27;);
    };


    //-------------------- END EVENT HANDLERS --------------------

    //------------------- BEGIN PUBLIC METHODS -------------------
    /**
     * initModule Populates the $container with the sidebar of the UI
     * and then configures and initializes feature modules.
     * @param container A single DOM HTMLElement
     * @param latest_clips_db the TAFFY db of clip objects
     */
    initModule = function( container, latest_clips_db ){

        if(container.nodeType !== utils.nodeTypes.ELEMENT_NODE){
            console.warn(&#x27;Invalid container for sidebar ui&#x27;);
            return;
        }
        // load HTML and map jQuery collections
        stateMap.$container = $(container);
        stateMap.latest_clips_db = latest_clips_db;

        stateMap.$container.append( configMap.main_html );
        setJqueryMap();

        //register search listener
        jqueryMap.$sidebar_search_submit.on(&#x27;click&#x27;, onSubmitSearch);
        jqueryMap.$sidebar_search_input.keypress(function(e){

                if (e.keyCode === 13){onSubmitSearch();}
            });

        //Inject Category, People data
        display_authors(jqueryMap.$sidebar_authors_listGroup, stateMap.latest_clips_db);
        util.fetchUrl(&#x27;/api/categories/&#x27;, function( results ){
            var formatted_categories = parseCategoryData( results );
            stateMap.category_db.insert(formatted_categories);
            display_categories(
                jqueryMap.$sidebar_category_listGroup,
                stateMap.category_db,
                stateMap.latest_clips_db
            );
        });

        //Navigation Menu Slider
        stateMap.$container.swipe({
            tap: onTouchSidebar,
            swipeLeft: onTouchSidebar,
            threshold: 75
        });

    };
    return { initModule: initModule };
}());

module.exports = sidebar;


    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
